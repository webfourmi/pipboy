<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1a12" />
  <title>Pip-Boy Spatial</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div style="padding:12px;color:#b7ffd9;">TEST AFFICHAGE ✅</div>
  <header class="topbar">
    <div class="brand">PIP-BOY // ORION</div>
    <div class="clock" id="clock">--:--</div>
  </header>

  <main class="shell">
    <nav class="tabs">
      <button class="tab active" data-view="status">STATUS</button>
      <button class="tab" data-view="data">DATA</button>
      <button class="tab" data-view="inv">INV</button>
    </nav>

    <section class="view active" id="status">
      <h1>STATUT</h1>

      <div class="grid">
        <div class="card">
          <h2>Énergie</h2>
          <div class="bar"><div class="barfill" id="energyFill" style="width:70%"></div></div>
          <div class="row">
            <input id="energy" type="range" min="0" max="100" value="70">
            <span id="energyLabel">70%</span>
          </div>
        </div>

        <div class="card">
          <h2>PV</h2>
          <div class="bar"><div class="barfill" id="hpFill" style="width:85%"></div></div>
          <div class="row">
            <input id="hp" type="range" min="0" max="100" value="85">
            <span id="hpLabel">85%</span>
          </div>
        </div>

        <div class="card">
          <h2>État</h2>
          <select id="state">
            <option>OK</option>
            <option>FATIGUÉ</option>
            <option>BLESSÉ</option>
            <option>CRITIQUE</option>
          </select>
          <p class="hint">Tout est sauvegardé sur le téléphone.</p>
        </div>
      </div>
    </section>

    <section class="view" id="data">
      <h1>DATA</h1>
      <div class="card">
        <h2>Journal de bord</h2>
        <textarea id="log" rows="8" placeholder="Note rapide…"></textarea>
        <div class="row right">
          <button id="clearLog" class="danger">Effacer</button>
          <button id="saveLog">Sauver</button>
        </div>
      </div>
    </section>

    <section class="view" id="inv">
      <h1>INVENTAIRE</h1>
      <div class="card">
        <h2>Objets</h2>
        <div class="row">
          <input id="itemInput" type="text" placeholder="Ajouter un objet (ex: Kit de réparation)">
          <button id="addItem">Ajouter</button>
        </div>
        <ul id="items" class="list"></ul>
        <div class="row right">
          <button id="clearInv" class="danger">Vider</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="bottombar">
    <div class="tiny">LOCAL SAVE • CONSOLE MODE</div>
  </footer>

  <script>
    function tick(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      document.getElementById('clock').textContent = `${hh}:${mm}`;
    }
    tick(); setInterval(tick, 1000);

    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.view).classList.add('active');
      });
    });

    const $ = (id) => document.getElementById(id);
    const store = {
      get(k, fallback){ try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch { return fallback; } },
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
    };

    const energy = $('energy'), hp = $('hp'), state = $('state');
    function syncBar(rangeEl, fillEl, labelEl){
      const val = Number(rangeEl.value);
      fillEl.style.width = `${val}%`;
      labelEl.textContent = `${val}%`;
    }
    function saveStatus(){
      store.set('status', { energy: Number(energy.value), hp: Number(hp.value), state: state.value });
    }
    function loadStatus(){
      const s = store.get('status', { energy: 70, hp: 85, state: 'OK' });
      energy.value = s.energy; hp.value = s.hp; state.value = s.state;
      syncBar(energy, $('energyFill'), $('energyLabel'));
      syncBar(hp, $('hpFill'), $('hpLabel'));
    }
    ['input','change'].forEach(evt => {
      energy.addEventListener(evt, () => { syncBar(energy, $('energyFill'), $('energyLabel')); saveStatus(); });
      hp.addEventListener(evt, () => { syncBar(hp, $('hpFill'), $('hpLabel')); saveStatus(); });
      state.addEventListener(evt, saveStatus);
    });
    loadStatus();

    const log = $('log');
    function loadLog(){ log.value = store.get('log', ''); }
    function saveLog(){ store.set('log', log.value); }
    $('saveLog').addEventListener('click', saveLog);
    $('clearLog').addEventListener('click', () => { log.value=''; saveLog(); });
    loadLog();

    const itemsUl = $('items');
    function renderInv(){
      const arr = store.get('inv', []);
      itemsUl.innerHTML = '';
      arr.forEach((txt, idx) => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${txt}</span><button class="mini" data-i="${idx}">X</button>`;
        itemsUl.appendChild(li);
      });
      itemsUl.querySelectorAll('button.mini').forEach(b => {
        b.addEventListener('click', () => {
          const arr2 = store.get('inv', []);
          arr2.splice(Number(b.dataset.i), 1);
          store.set('inv', arr2);
          renderInv();
        });
      });
    }
    $('addItem').addEventListener('click', () => {
      const val = $('itemInput').value.trim();
      if(!val) return;
      const arr = store.get('inv', []);
      arr.unshift(val);
      store.set('inv', arr);
      $('itemInput').value = '';
      renderInv();
    });
    $('clearInv').addEventListener('click', () => { store.set('inv', []); renderInv(); });
    renderInv();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>
